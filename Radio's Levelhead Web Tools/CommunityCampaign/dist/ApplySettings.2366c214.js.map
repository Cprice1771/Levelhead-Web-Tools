{"version":3,"sources":["../ApplySettings.js"],"names":["delegationKeyValid","toolNames","currentToolName","getCurrentToolName","name","window","location","href","substring","lastIndexOf","length","generateToolFooter","htmlout","forEach","document","body","innerHTML","levelFetchUrl","stats","aliases","records","interactions","limit","basicURL","getProfileCode","input","clean","trim","toLowerCase","result","exec","getLevelCode","getAnyCode","getPlaylistCode","getAvatarURL","avatarId","size","getExtendedRequestBody","method","requestBody","JSON","parse","localStorage","getItem","Key","delegationKeyChecked","checkDelegationKey","fetch","then","r","status","exception","addInteractionDetails","getInteractions","level","ownLevel","userId","UserCode","possibleInteractions","bookmarked","liked","favorited","played","completed","manageBookmark","levelCode","mode","console","log","cursorOptions","setCursorTemplate","loadOptions","loadCursor","cursor","includes","style","replaceAll","timeFormat","time","millis","Math","floor","toFixed","Date","toISOString","substr","replace","dateFormat","date","toString"],"mappings":"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","file":"ApplySettings.2366c214.js","sourceRoot":"..","sourcesContent":["//Global Variables\r\n/**\r\n * specifies if there's a valid delegation key. set by checkDelegationKey()\r\n */\r\nvar delegationKeyValid = false;\r\n\r\n//#region html generation\r\n\r\n/**\r\n * Contains names and folders for the generation of the footer\r\n * \r\n * position 0: folder name, position 1: display name\r\n */\r\nvar toolNames = [\r\n    [\"Setting\", \"Site Settings\"],\r\n    [\"ProfileLevelViewer\", \"Profile Level Viewer\"],\r\n    [\"AdvancedMDSearch\", \"Advanced Marketing Department Search\"],\r\n    [\"DailyBuildViewer\", \"Daily Build Viewer\"],\r\n    [\"HiddenLevelStatistics\", \"Hidden Level Statistics viewer\"],\r\n    [\"HiddenProfileStatisticsViewer\", \"Hidden Profile Statistics Viewer\"],\r\n    [\"RecordViewer\", \"Record Viewer\"],\r\n    [\"CombobulatorSimulator\", \"Combobulator Simulator\"],\r\n    [\"PictureGallery\", \"Avatar Gallery\"],\r\n    [\"AdvancedTowerSearch\", \"Advanced Tower Search\"],\r\n    [\"TowerTrialViewer\", \"Tower Trial Viewer\"],\r\n    [\"SubmitFeedback\", \"Feedback Submission\"]\r\n]\r\n/**\r\n * Folder of the current tool. loaded by currentToolName()\r\n */\r\nvar currentToolName = \"\";\r\n\r\n/**\r\n * Retrieves the name of the current folder and saves it in currentToolName\r\n * @returns Name of the current folder\r\n */\r\nfunction getCurrentToolName(){\r\n    var name = window.location.href;\r\n\r\n    name = name.substring(0, name.lastIndexOf('/'));\r\n    name = name.substring(name.lastIndexOf('/')+1, name.length);\r\n    currentToolName = name;\r\n    return name;\r\n}\r\n\r\n/**\r\n * Generates a footer linking to other tools\r\n * @note The site has to be in a folder inside the main folder, otherwise this won't work\r\n */\r\nfunction generateToolFooter(){\r\n    getCurrentToolName();\r\n\r\n    var htmlout = \"\";\r\n\r\n    toolNames.forEach(name => {\r\n        if(name[0] != currentToolName)\r\n            htmlout += `<p><a href=\"../${name[0]}/index.html\">${name[1]}</a></p>`\r\n    })\r\n    document.body.innerHTML += `<footer id=\"navigationFooter\"><p><b>Other Tools:</b></p><p><b><a href=\"../index.html\">Main Page</a></b></p>${htmlout}</footer>`;\r\n}\r\n\r\n//#endregion\r\n\r\n//#region general purpose functions\r\n\r\n/**\r\n * Returns a URL to be used for Level fetch calls\r\n * @param {Boolean} stats if true, includes stats (Plays, playtime, etc.)\r\n * @param {Boolean} aliases if true, includes alias (player name, etc.)\r\n * @param {Boolean} records if true, includes leaderboards (shoe, ribbon)\r\n * @param {Boolean} interactions if true includes interactions (boommarked, played, etc.). WARNING: Must be used with a delegation key.\r\n * @param {Number} limit Maximun number of levels to be returned.\r\n * @returns URL for a level fetch call\r\n */\r\nfunction levelFetchUrl(stats = true, aliases = true, records = true, interactions = false, limit = 128){\r\n    var basicURL = 'https://www.bscotch.net/api/levelhead/levels?limit=' + limit\r\n    if(stats)\r\n        basicURL += '&includeStats=true'\r\n    if(aliases)\r\n        basicURL += '&includeAliases=true'\r\n    if(records)\r\n        basicURL += '&includeRecords=true'\r\n    if(interactions)\r\n        basicURL += '&includeMyInteractions=true'\r\n\r\n    return basicURL\r\n}\r\n\r\n/**\r\n * Input sanitization for Creator codes\r\n * @param {String} input creator code or profile link. the levelhead.io and bschotch.net links both work\r\n * @returns null if code could not be extracted\r\n * @returns the cleaned code\r\n */\r\nfunction getProfileCode(input = \"\"){\r\n    var clean = input.trim().toLowerCase();\r\n    if(input.length == 6)\r\n        return clean;\r\n    var result = /levelhead\\.io\\/@(.{6})/.exec(clean);\r\n\r\n    if(result == null)\r\n        result = /bscotch\\.net\\/games\\/levelhead\\/players\\/(.{6})/.exec(clean);\r\n    \r\n    if(result == null)\r\n        return null;\r\n    \r\n    return result[1];\r\n}\r\n\r\n/**\r\n * Input sanitization for Level codes\r\n * @param {String} input level code or level link. the levelhead.io and bschotch.net links both work\r\n * @returns null if code could not be extracted\r\n * @returns the cleaned code\r\n */\r\nfunction getLevelCode(input = \"\"){\r\n    var clean = input.trim().toLowerCase();\r\n    if(input.length == 7)\r\n        return clean;\r\n\r\n    var result = /levelhead\\.io\\/\\+(.{7})/.exec(clean);\r\n\r\n    if(result == null)\r\n        result = /bscotch\\.net\\/games\\/levelhead\\/levels\\/(.{7})/.exec(clean);\r\n\r\n    if(result == null)\r\n        return null;\r\n        \r\n    return result[1];\r\n}\r\n\r\n/**\r\n * Input sanitization for Creator codes and profile codes. Can distinguish the 2, but cannot handle playlists\r\n * @param {String} input creator/level code or profile/level link. the levelhead.io and bschotch.net links both work\r\n * @returns null if code could not be extracted\r\n * @returns the cleaned code. result[0] is either 'Profile' or 'Level' depemding on what the code is for. result[1] is the code\r\n */\r\nfunction getAnyCode(input = \"\"){\r\n    var result = getProfileCode(input);\r\n    \r\n    if(result != null)\r\n        return ['Profile', result];\r\n    result = getLevelCode(input);\r\n\r\n    if(result != null)\r\n        return ['Level', result];\r\n    \r\n    return null;\r\n}\r\n/**\r\n * Input sanitization for Playlist codes\r\n * @param {String} input playlist code or playlist link. the levelhead.io and bschotch.net links both work\r\n * @returns null if code could not be extracted\r\n * @returns the cleaned code\r\n */\r\nfunction getPlaylistCode(input = \"\"){\r\n    var clean = input.trim().toLowerCase();\r\n    if(input.length == 7)\r\n        return clean;\r\n\r\n    var result = /levelhead\\.io\\/\\-(.{7})/.exec(clean);\r\n\r\n    if(result == null)\r\n        result = /bscotch\\.net\\/games\\/levelhead\\/playlists\\/(.{7})/.exec(clean);\r\n\r\n    if(result == null)\r\n        return null;\r\n        \r\n    return result[1];\r\n}\r\n\r\n/**\r\n * Creates a URL to load an avatar with\r\n * @param {String} avatarId id of the avatar. see https://beta.bscotch.net/api/docs/community-edition/#avatars\r\n * @param {Number} size specifies size of the returned avatar. it will be size x size big\r\n * @returns URL to load an avatar with\r\n */\r\nfunction getAvatarURL(avatarId, size = 100){\r\n    return `https://img.bscotch.net/fit-in/${size}x${size}/avatars/${avatarId}.webp`;\r\n}\r\n\r\n/**\r\n * creates a request body for fetch calls making use of delegation keys\r\n * @param {String} method either 'GET', 'POST', 'PUT' or 'DELETE'\r\n * @returns A request body to be used with the fetch function. fetch(URL, RequestBody)\r\n */\r\nfunction getExtendedRequestBody(method = 'GET'){\r\n    var requestBody = {\r\n        'method': method,\r\n        'headers': {\r\n            'Rumpus-Delegation-Key' : JSON.parse(window.localStorage.getItem('DelegationKey')).Key\r\n        },\r\n        'mode': 'cors',\r\n        'cache': 'default'\r\n    }\r\n    return requestBody;\r\n}\r\n\r\nvar delegationKeyChecked = false\r\n/**\r\n * Checks if the Delegation Key is valid. sets delegationKeyValid to true if valid, false if invalid\r\n */\r\nfunction checkDelegationKey(){\r\n    try{\r\n    if(window.localStorage.getItem('DelegationKey'))\r\n    fetch('https://www.bscotch.net/api/levelhead/aliases?userIds=@me', getExtendedRequestBody('GET'))\r\n    .then(function(r){ \r\n        delegationKeyValid = (r.status == '200')\r\n        delegationKeyChecked = true\r\n    }) //see if status is OK\r\n    }\r\n    catch(exception){//fetch failed means no internet connection or key is invalid\r\n        delegationKeyValid = false\r\n        delegationKeyChecked = true\r\n    }\r\n}\r\n\r\n/**\r\n * used for API calls that support includeMyInteractions\r\n * @returns \"\" if there's no valid delegation key, else \"&includeMyInteractions=true\"\r\n */\r\nfunction addInteractionDetails()\r\n{\r\n    return delegationKeyValid ? \"&includeMyInteractions=true\" : \"\";\r\n}\r\n\r\n/**\r\n * Get the interactions (played, completed, etc.) from a level\r\n * @param {LEVEL} level level object, returned by level-related api calls\r\n * @returns interactions object. contains 'bookmarked', 'liked', 'favorited', 'played' and 'completed'.\r\n *  all but 'bookmarked' are set to true if the level was made by the player whose delegation key is used\r\n */\r\nfunction getInteractions(level){\r\n    //checks if level was created by user\r\n    var ownLevel = level.userId == JSON.parse(window.localStorage.getItem('DelegationKey')).UserCode;\r\n    var possibleInteractions = {\r\n        'bookmarked':false,\r\n        'liked':ownLevel,\r\n        'favorited':ownLevel,\r\n        'played':ownLevel,\r\n        'completed':ownLevel\r\n    }\r\n    //check if any interactions, then add interactions\r\n    if(level.interactions){\r\n        //double negation for conversion in bool (can otherwise be undefined)\r\n        possibleInteractions.bookmarked = level.interactions.bookmarked ?true:false;\r\n        if(!ownLevel){\r\n            possibleInteractions.liked = level.interactions.liked ?true:false;\r\n            possibleInteractions.favorited = level.interactions.favorited ?true:false;\r\n            possibleInteractions.played = level.interactions.played ?true:false;\r\n            possibleInteractions.completed = level.interactions.completed ?true:false;\r\n        }\r\n    }\r\n    return possibleInteractions;\r\n    \r\n}\r\n\r\n//Bookmarks\r\n\r\n/**\r\n * Can add/remove Bookmarks\r\n * @param {String} levelCode a level's level code. must be sanitized\r\n * @param {String} mode 'PUT' to create bookmark (default), 'DELETE' to remove Bookmark\r\n * @returns true if successful, false if unsuccessful. posts error messages using console.log\r\n */\r\nfunction manageBookmark(levelCode, mode = 'PUT') {\r\n    console.log(JSON.parse(window.localStorage.getItem('DelegationKey')).Key);\r\n    try{\r\n        fetch(`https://www.bscotch.net/api/levelhead/bookmarks/${levelCode}`,\r\n            getExtendedRequestBody(mode));\r\n        return true;\r\n    }\r\n    catch(exception){\r\n        console.log('BOOKMARK FAILED; ACTION: '+ mode);\r\n        return false;\r\n    }\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Customization\r\n\r\n/**\r\n * contains cursor colors. file name must be <color>.png\r\n */\r\nvar cursorOptions = [\r\n    \"normal\",\r\n    \"blue\",\r\n    \"green\",\r\n    \"fuchsia\",\r\n    \"orange\"\r\n];\r\n/**\r\n * path to cursors. used in the CSS\r\n */\r\nvar setCursorTemplate = \"url('../PicturesCommon/Cursors/{{color}}.png'), auto\";\r\n\r\n/**\r\n * loads cursor options and loads delegation key.\r\n */\r\nfunction loadOptions(){\r\n    loadCursor();\r\n    checkDelegationKey();\r\n}\r\n\r\n/**\r\n * loads custom cursors\r\n */\r\nfunction loadCursor(){\r\n    var cursor = window.localStorage.getItem('CursorOption');\r\n    if(cursor && cursor != cursorOptions[0] && cursorOptions.includes(cursor)){\r\n        document.body.style.cursor = setCursorTemplate.replaceAll('{{color}}', cursor);\r\n        //ToDo: set other cursors\r\n    }\r\n}\r\n\r\n//#endregion\r\n\r\n//#region other\r\n\r\n/**\r\n * transforms a time in seconds into a formatted string\r\n * @param {Number} time time in seconds\r\n * @returns formatted time string\r\n */\r\nfunction timeFormat(time){ //ToDo: document this monstrosity\r\n    var millis = \"\";\r\n    millis = Math.floor(time*100).toFixed();\r\n    if(time >= 86400)\r\n        return Math.floor(time/86400) +'day(s) '+ (new Date(time * 1000).toISOString().substr(11, 8)+'.'+millis.substr(millis.length-2, millis.length-1)+'s').replace(':', 'h ').replace(':', 'm ');\r\n    if(time >= 3600)\r\n        return (new Date(time * 1000).toISOString().substr(11, 8)+'.'+millis.substr(millis.length-2, millis.length-1)+'s').replace(':', 'h ').replace(':', 'm ');\r\n    if(time >= 60)\r\n        return (new Date(time * 1000).toISOString().substr(14, 5)+'.'+millis.substr(millis.length-2, millis.length-1)+'s').replace(':', 'm ');\r\n    return (new Date(time * 1000).toISOString().substr(17, 2)+'.'+millis.substr(millis.length-2, millis.length-1)+'s');\r\n}\r\n\r\n/**\r\n * Formats a date object\r\n * @param {Date} date Date object to format\r\n * @returns Formatted Date as a string\r\n */\r\nfunction dateFormat(date){\r\n    return new Date(date).toString().substring(4,31)\r\n}\r\n\r\n//#endregion\r\n\r\n//#region Old stuff. not needed, but I'll keep it here just in case\r\n\r\n\r\n\r\n\r\n//old card template\r\n/*\r\nvar levelCardTemplate = `\r\n<div class=\"column\"><div class=\"card\">\r\n<img src=\"https://img.bscotch.net/fit-in/100x100/avatars/{{avatar}}.webp\" id=\"cardPicture\">\r\n<img src=\"../PicturesCommon/CardIcons/{{graduated}}.png\" id=\"miniIcon\" style=\"margin-left:2px;\">\r\n<img src=\"../PicturesCommon/CardIcons/TT.png\" id=\"miniIcon\" style=\"margin-left:80px;display:{{tt}};\">\r\n<img src=\"../PicturesCommon/CardIcons/DAILYBUILD.png\" id=\"miniIcon\" style=\"margin-top:75px;margin-left:6px;display:{{daily}};\">\r\n    <p id=\"cardText\">\r\n        <a href=\"https://levelhead.io/+{{levelcode}}\" target=\"ProfileLevel\">{{levelname}}</a><br>\r\n        <a style=\"color:#7E3517\">♥️</a>: {{likes}}, <a style=\"color:#7F5217\">★</a>: {{favorites}}, {{difficulty}}<br>\r\n        {{tags}}<br>\r\n        <b>Players:</b> {{players}}, <b>Plays:</b> {{plays}}<br>\r\n        <b>Created:</b> {{createdAt}}<br>\r\n        <button onclick=\"navigator.clipboard.writeText('{{levelcode}}')\" style=\"height: 20px; font-size: 10px;\" id=\"levelCodeButton\">Copy Levelcode</button>\r\n    </p>\r\n</div></div>\r\n`;\r\n*/\r\n\r\n//#endregion"]}